# Test Design: Story 3.10 - CSV Format Options

Date: 2025-01-12
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 28
- Unit tests: 15 (54%)
- Integration tests: 10 (36%)
- E2E tests: 3 (10%)
- Priority distribution: P0: 12, P1: 11, P2: 5

## Test Scenarios by Acceptance Criteria

### AC1: QuickBooks & Xero templates included

#### Scenarios

| ID | Level | Priority | Test | Justification |
|---|---|---|---|---|
| 3.10-UNIT-001 | Unit | P0 | QuickBooks date formatting (MM/dd/yyyy) | Pure formatting logic, critical for compliance |
| 3.10-UNIT-002 | Unit | P0 | QuickBooks required fields validation | Must match import requirements |
| 3.10-UNIT-003 | Unit | P0 | Xero date formatting (dd/MM/yyyy) | Pure formatting logic, critical for compliance |
| 3.10-UNIT-004 | Unit | P0 | Xero required fields validation | Must match import requirements |
| 3.10-UNIT-005 | Unit | P0 | CSV injection prevention for all formats | Security critical, pure logic |
| 3.10-UNIT-006 | Unit | P1 | Generic format structure validation | Default format must work |
| 3.10-UNIT-007 | Unit | P1 | UTF-8 encoding for all formats | Character encoding compliance |
| 3.10-UNIT-008 | Unit | P1 | Amount formatting precision (0.00) | Financial accuracy required |
| 3.10-INT-001 | Integration | P0 | CSVExportService generates valid QuickBooks CSV | Service integration test |
| 3.10-INT-002 | Integration | P0 | CSVExportService generates valid Xero CSV | Service integration test |
| 3.10-INT-003 | Integration | P1 | Export with malicious merchant names | Security integration test |
| 3.10-E2E-001 | E2E | P1 | Complete export flow with format selection | Critical user journey |

### AC2: Format selection dropdown/radio buttons

#### Scenarios

| ID | Level | Priority | Test | Justification |
|---|---|---|---|---|
| 3.10-UNIT-009 | Unit | P1 | FormatSelectionWidget renders all format options | UI component logic |
| 3.10-UNIT-010 | Unit | P2 | Format descriptions display correctly | UI text validation |
| 3.10-WIDGET-001 | Widget | P0 | Format selection UI interaction | Core UI functionality |
| 3.10-WIDGET-002 | Widget | P0 | Keyboard navigation through formats | Accessibility requirement |
| 3.10-WIDGET-003 | Widget | P1 | Screen reader announces format changes | Accessibility requirement |
| 3.10-WIDGET-004 | Widget | P2 | Visual feedback on format selection | User experience |
| 3.10-INT-004 | Integration | P0 | Format selection updates provider state | State management flow |
| 3.10-INT-005 | Integration | P1 | Format change triggers preview update | User feedback |

### AC3: Format persistence in app settings

#### Scenarios

| ID | Level | Priority | Test | Justification |
|---|---|---|---|---|
| 3.10-UNIT-011 | Unit | P0 | Settings model stores format preference | Data model validation |
| 3.10-UNIT-012 | Unit | P0 | Settings migration handles null format | Backward compatibility |
| 3.10-UNIT-013 | Unit | P1 | Default format is ExportFormat.generic | Sensible defaults |
| 3.10-INT-006 | Integration | P0 | Format preference persists to storage | Core persistence |
| 3.10-INT-007 | Integration | P0 | Format preference loads on app start | User experience |
| 3.10-INT-008 | Integration | P1 | Settings corruption handled gracefully | Error resilience |
| 3.10-E2E-002 | E2E | P1 | Format selection persists across app restarts | User journey validation |
| 3.10-E2E-003 | E2E | P2 | Format preference migrates on app update | Long-term stability |

## Risk Coverage

| Risk ID | Mitigating Tests | Coverage Level |
|---------|------------------|----------------|
| SEC-001 | 3.10-UNIT-005, 3.10-INT-003 | High |
| DATA-001 | 3.10-UNIT-001 through 004, 3.10-INT-001, 002 | High |
| TECH-001 | 3.10-INT-004, 3.10-INT-005 | Medium |
| DATA-002 | 3.10-UNIT-012, 3.10-INT-008 | High |
| SEC-002 | Not directly testable in unit/integration | Low |
| BUS-001 | 3.10-UNIT-010, 3.10-WIDGET-004 | Medium |

## Test Data Requirements

### Format Test Data
```dart
// QuickBooks test cases
- Valid: Date="12/31/2024", Amount="123.45", Vendor="ABC Corp", Account="Expenses"
- Edge: Date="01/01/2024", Amount="0.00", Vendor="", Account="Other"
- Invalid: Date="2024-12-31" (wrong format), Amount="123.456" (too many decimals)

// Xero test cases  
- Valid: Date="31/12/2024", Amount="123.45", Reference="INV-001", Description="Services"
- Edge: Date="29/02/2024" (leap year), Amount="999999.99", Reference="", Description=""

// Injection test cases
- Malicious merchant: "=cmd|'/c calc'!A1"
- Special chars: "ABC & Co., Ltd."
- Unicode: "Café München €"
```

### Settings Test Data
```dart
// Migration scenarios
- Null exportFormat
- Invalid enum value
- Corrupted JSON
- Missing settings file
```

## Recommended Execution Order

1. **P0 Unit tests** (fail fast on core logic)
   - Format validation tests
   - Security tests
   - Data model tests

2. **P0 Integration tests**
   - CSV generation validation
   - State management
   - Settings persistence

3. **P0 Widget tests**
   - UI interaction
   - Accessibility

4. **P1 tests** (user experience)
   - Complete workflows
   - Error handling
   - Additional security

5. **P2 tests** (polish)
   - Visual feedback
   - Migration scenarios

## Testing Approach Notes

### Unit Test Focus
- Heavy emphasis on format compliance testing (54% unit coverage)
- Each format rule should have dedicated test
- Mock external dependencies (file system, settings)

### Integration Test Focus  
- Validate actual CSV output against sample files
- Test state management flows
- Verify persistence mechanisms

### E2E Test Focus
- Minimal E2E (10%) as functionality is well-covered at lower levels
- Focus on critical user journeys only
- Manual verification with actual QuickBooks/Xero imports recommended

## Coverage Gaps and Recommendations

1. **File System Permissions** (SEC-002): Cannot be effectively unit tested. Recommend manual testing on different OS configurations.

2. **Actual Import Validation**: While we test format compliance, actual import into QuickBooks/Xero should be manually verified during UAT.

3. **Performance Testing**: Large dataset performance (PERF-001) not included due to low risk. Add if user base grows.

---

Test design matrix: docs/qa/assessments/3.10-test-design-20250112.md
P0 tests identified: 12